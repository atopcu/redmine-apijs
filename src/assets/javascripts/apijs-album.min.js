/*!
 * Copyright 2008-2014 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://www.luigifab.fr/redmine/apijs - 5.0.0
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
"use strict";function showDialogError(e){apijs.dialog.dialogInformation(apijs.i18n.translate("errorTitle"),"number"==typeof e?apijs.i18n.translate("error"+e):e,"error")}function editAttachment(e,t,a){"string"!=typeof apijs.i18n.data.en.editTitle&&(apijs.i18n.data.en.editTitle="Edit a description",apijs.i18n.data.fr.editTitle="Modifier une description",apijs.i18n.data.en.editText="Enter below the new description for the file. To remove the description, leave the field empty.",apijs.i18n.data.fr.editText="Saisissez ci-dessous la nouvelle description pour ce fichier. Pour supprimer la description, laissez le champ vide.",apijs.i18n.data.en.errorTitle="Error",apijs.i18n.data.fr.errorTitle="Erreur",apijs.i18n.data.en.error403="You are not authorized to perform this operation.",apijs.i18n.data.fr.error403="Vous n'êtes pas autorisé(e) à effectuer cette opération.",apijs.i18n.data.en.error404="Sorry, the file no longer exists, please [a href='javascript:location.reload();']refresh the page[/a].",apijs.i18n.data.fr.error404="Désolé, le fichier n'existe plus, veuillez [a href='javascript:location.reload();']actualiser la page[/a].");var i=document.getElementById("attachmentId"+e).querySelector("span.description").firstChild.nodeValue.trim(),r='[p][label for="text"]'+apijs.i18n.translate("editText")+"[/label][/p]";r+='[input type="text" name="description" value="'+i+'" id="text"]',r+='[input type="hidden" name="authenticity_token" value="'+a+'"]',r+='[input type="hidden" name="id" value="'+e+'"]',apijs.dialog.dialogFormOptions(apijs.i18n.translate("editTitle"),r,t,actionEditAttachment,a,"editattachment")}function actionEditAttachment(e,t){if("boolean"==typeof e)return!0;var i;"string"==typeof e&&((i=new XMLHttpRequest).open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("X-CSRF-Token",t),i.onreadystatechange=function(){var e,t,a;4===i.readyState&&200===i.status?0===i.responseText.indexOf("attachmentId")?(e=i.responseText.slice(0,i.responseText.indexOf(":")),t=i.responseText.slice(i.responseText.indexOf(":")+1),(a=document.getElementById(e).querySelector("span.description").firstChild).replaceData(0,a.length,t),(a=document.getElementById(e).querySelector("input"))&&(a.value=a.value.slice(0,a.value.lastIndexOf("|")+1)+t),(a=document.getElementById(e).querySelector("img"))&&a.setAttribute("alt",t),apijs.dialog.actionClose()):0===i.responseText.indexOf("<!DOCTYPE")?(apijs.dialog.styles.remove("lock"),location.reload()):showDialogError(i.responseText):4===i.readyState&&403===i.status?showDialogError(403):4===i.readyState&&404===i.status&&showDialogError(404)},i.send(apijs.serialize(document.getElementById("apijsBox"))))}function deleteAttachment(e,t,a){"string"!=typeof apijs.i18n.data.en.deleteTitle&&(apijs.i18n.data.en.deleteTitle="Delete a file",apijs.i18n.data.fr.deleteTitle="Supprimer un fichier",apijs.i18n.data.en.deleteText="Are you sure you want to delete this file?[br]Be careful, you can't cancel this operation.",apijs.i18n.data.fr.deleteText="Êtes-vous certain de vouloir supprimer ce fichier ?[br]Attention, cette opération n'est pas annulable.",apijs.i18n.data.en.errorTitle="Error",apijs.i18n.data.fr.errorTitle="Erreur",apijs.i18n.data.en.error403="You are not authorized to perform this operation.",apijs.i18n.data.fr.error403="Vous n'êtes pas autorisé(e) à effectuer cette opération.",apijs.i18n.data.en.error404="Sorry, the file no longer exists, please [a href='javascript:location.reload();']refresh the page[/a].",apijs.i18n.data.fr.error404="Désolé, le fichier n'existe plus, veuillez [a href='javascript:location.reload();']actualiser la page[/a]."),apijs.dialog.dialogConfirmation(apijs.i18n.translate("deleteTitle"),apijs.i18n.translate("deleteText"),actionDeleteAttachment,[t,e,a])}function actionDeleteAttachment(e){var t=new XMLHttpRequest;t.open("POST",e[0],!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.setRequestHeader("X-CSRF-Token",e[2]),t.onreadystatechange=function(){4===t.readyState&&200===t.status?0===t.responseText.indexOf("attachmentId")?(document.getElementById(t.responseText).parentNode.removeChild(document.getElementById(t.responseText)),apijs.dialog.actionClose()):0===t.responseText.indexOf("<!DOCTYPE")?(apijs.dialog.styles.remove("lock"),location.reload()):showDialogError(t.responseText):4===t.readyState&&403===t.status?showDialogError(403):4===t.readyState&&404===t.status&&showDialogError(404)},t.send("id="+encodeURIComponent(e[1])+"&authenticity_token="+encodeURIComponent(e[2]))}